version: "3.9"

services: 
  app: 
    image: node:20-alpine
    volumes: 
      - ./app:/usr/src/app
    ports: 
      - "3000:3000"
    depends_on: 
      redis: 
        condition: service_healthy
    environment:
      - REDIS_HOST=redis
      - REDIS_PORT=6379
    command: sh -c "npm install && node index.js"

  redis: 
    image: "redis:7-alpine"
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 5s
      timeout: 2s
      retries: 5
